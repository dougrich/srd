/*
Copyright (c) 2016 Douglas Richardson
*/
!function(e){function n(e){function n(e,n){var t=new XMLHttpRequest;t.onload=function(){200!==this.status?n(this.status,this.responseText):n(null,this.responseText)},t.onerror=function(){n(c.errCouldntFetchFile)},t.open("GET",e),t.send()}function t(e,n){var t=u.transaction([s.tbname],"readwrite").objectStore(s.tbname).get(e);t.onsuccess=function(e){e.target.result?n(null,e.target.result.body):n(s.cacheMiss,null)}}function o(e,n,t){e||u.transaction([s.tbname],"readwrite").objectStore(s.tbname).add({name:n.file,body:t})}function r(n){return function(t,o){e({id:n.id,err:t,result:o})}}function a(){for(;d.length;)!function(e){var a=r(e);null===u?n(e.file,a):t(e.file,function(t,r){t===s.cacheMiss?n(e.file,function(n,t){a(n,t),o(n,e,t)}):a(t,r)})}(d.pop())}var s={version:2,dbname:"__offline-loader-db",tbname:"_resources",cacheMiss:"Missed Cache",processorInterval:100},c={errDbNotCreatedSuccessfully:"IndexedDB not created successfully",errCouldntFetchFile:"Unable to fetch the file"},i=window._indexedDB||window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,l=i.open(s.dbname,s.version),u=null,d=[];return l.onupgradeneeded=function(e){var n=e.target.result,t=n.createObjectStore(s.tbname,{keyPath:"name"});t.createIndex("name","name",{unique:!0}),t.transaction.oncomplete=function(e){u=n,setInterval(a,s.processorInterval)}},l.onsuccess=function(e){u=e.target.result,setInterval(a,s.processorInterval)},l.onerror=function(e){u=null,setInterval(a,s.processorInterval),console.error(c.errDbNotCreatedSuccessfully)},function(n){if("clear"===n.data.action){var t=u.transaction([s.tbname],"readwrite").objectStore(s.tbname).clear();t.onsuccess=function(n){e({action:"clear"})}}else d.push(n.data)}}if(window){var t=window.offline||(window.offline={});t._fallback=n(function(e){t._fallbackPost({data:e})})}else self.onmessage=n(function(e){self.postMessage(e)})}(window||self);
/*
Copyright (c) 2016 Douglas Richardson
*/
!function(n,r){function a(){}function i(n){"clear"===n.data.action?t():u[n.data.id]?(u[n.data.id](n.data.err,n.data.result),delete u[n.data.id]):console.error(l.errorUnwatched+n.data.id)}function o(n,r){if(Array.isArray(n))for(var a=[],i=[],o=0,e=!1,l=0;l<n.length;l++)a.push(null),i.push(null),function(l){var t=s++;u[t]=function(t,f){o++,(a[l]=t)&&(e=!0),i[l]=f,o===n.length&&r(e?t:null,i)},w({id:t,file:n[l]})}(l);else{var t=s++;u[t]=r,w({id:t,file:n})}}function e(n){t=n||a,w({action:"clear"})}var l={errorUninitialized:"Offline Loader Error: worker thread is not initialized",errorUnwatched:"Missing a callback handler for: "},t=a,f={workerScript:"/src/offline-async-worker.js"};r=r||{};for(var d in f)r[d]=r[d]||f[d];var c=null,s=0,u={},w=null;n._fallback?(w=function(r){n._fallback({data:r})},n._fallbackPost=i):(c=new Worker(r.workerScript),c.onmessage=i,w=function(n){c.postMessage(n)}),n.load=o,n.clear=e}(window.offline||(window.offline={}),window.offlineConfig||(window.offlineConfig=null));